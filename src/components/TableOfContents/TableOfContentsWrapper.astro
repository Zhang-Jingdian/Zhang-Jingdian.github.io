---
import TableOfContents from './TableOfContents.vue';

interface Props {
	html: string;
}

const { html } = Astro.props;

// 从渲染的 HTML 中提取标题生成目录
const extractHeadings = (htmlContent: string) => {
	const headingRegex = /<h([2-3])[^>]*id="([^"]*)"[^>]*>(.*?)<\/h\1>/g;
	const headings: Array<{ text: string; id: string; level: number }> = [];
	let match;

	while ((match = headingRegex.exec(htmlContent)) !== null) {
		headings.push({
			level: parseInt(match[1]),
			id: match[2],
			text: match[3].replace(/<[^>]*>/g, '') // 移除 HTML 标签
		});
	}

	return headings;
};

const headings = html ? extractHeadings(html) : [];
---

{headings.length > 0 && (
	<aside class="hidden lg:block">
		<TableOfContents client:load headings={headings} />
	</aside>
)}
