# 🎯 Ubuntu + xRDP + GNOME 远程桌面完整解决方案总结 🐱‍💻

这是你亲手打通的一条王道远程连接之路，适用于 **Mac 远程控制 Ubuntu（图形界面）** 的经典组合，兼容 GNOME 桌面，适合开发、调试、GUI 运行！

---

## ✅ 1. 安装必要组件（Ubuntu端）

```bash
sudo apt update
sudo apt install -y ubuntu-desktop gnome-session gdm3 xrdp dbus-x11
```

---

## ✅ 2. 配置 xRDP 会话启动脚本

编辑 `/etc/xrdp/startwm.sh`：

```bash
sudo nano /etc/xrdp/startwm.sh
```

清空内容，只保留👇：

```bash
#!/bin/sh
exec gnome-session
```

然后加执行权限：

```bash
sudo chmod +x /etc/xrdp/startwm.sh
```

---

## ✅ 3. 禁用 Wayland（防止黑屏）

编辑 GDM 配置：

```bash
sudo nano /etc/gdm3/custom.conf
```

找到：

```ini
#WaylandEnable=false
```

取消注释变为：

```ini
WaylandEnable=false
```

保存后重启系统：

```bash
sudo reboot
```

---

## ✅ 4. Mac端使用 Microsoft Remote Desktop 连接

- 打开 `Microsoft Remote Desktop`
    
- 添加新连接：
    
    - **PC 名称**：`192.168.0.104`（你的 Ubuntu IP）
        
    - **用户名**：`zjd`
        
    - **密码**：你的登录密码
        
- 双击连接，几秒后进入 Ubuntu GNOME 桌面 🎉
    

---

## ✅ 5. 常见问题排查

|问题|解决办法|
|---|---|
|连接后黑屏/闪退|确保禁用 Wayland + 正确 `startwm.sh`|
|连接失败（Disconnect Ultimatum）|桌面环境缺失 → 安装 `ubuntu-desktop`|
|防火墙端口被拦|`sudo ufw allow 3389/tcp`|

---

## 🎁 Bonus：测试命令合集（排查专用）

```bash
# 检查 xRDP 状态
sudo systemctl status xrdp

# 检查启动脚本
cat /etc/xrdp/startwm.sh

# 检查是否是 Wayland
echo $XDG_SESSION_TYPE

# 检查远程端口连通性（在 Mac 上）
nc -vz 192.168.0.104 3389

# 查看连接日志
journalctl -u xrdp
```

---

## 🎉 总结一句话：

> **让 xRDP + GNOME 成功跑起来的关键是：**  
> ✅ 桌面组件完整 → ✅ 启动脚本正确 → ✅ 禁用 Wayland → ✅ 客户端设置匹配。
