---
import '@/styles/global.css'
import BaseHead from '@/components/BaseHead'
import BaseHeader from '@/components/BaseHeader'
import BaseFooter from '@/components/BaseFooter'
import SpeedInsights from '@vercel/speed-insights/astro'
import type { ImageMetadata } from 'astro'
import { getCollection } from 'astro:content'

interface Props {
  title: string
  description?: string
  keywords?: string[]
  image?: ImageMetadata | string
}

const { title, description, keywords, image } = Astro.props

// 获取所有博客文章用于搜索
const allPosts = await getCollection('blog')
const posts = allPosts.map((post) => ({
  slug: post.id,
  data: {
    title: post.data.title,
    description: post.data.description || '',
    tags: post.data.tags || [],
  },
}))

// 检测是否在 Vercel 环境
const isVercel = import.meta.env.VERCEL === '1' || Astro.site?.hostname.includes('vercel.app')
---

<!DOCTYPE html>
<html lang="zh-CN" class="overflow-y-scroll">
	<head>
		<BaseHead title={title} description={description} keywords={keywords} image={image} />
	</head>
	<body class="flex min-h-screen flex-col bg-white text-neutral-900 antialiased">
		<!-- 页头导航 - 页面加载时立即渲染，传入当前路径避免 hydration 不一致 -->
		<BaseHeader client:load currentPath={Astro.url.pathname} posts={posts} />
		
		<!-- 主内容区（子布局会插入这里） - flex-1 让它填充剩余空间 -->
		<div class="flex-1">
			<slot />
		</div>
		
		<!-- 页脚 - 进入视口时才加载（性能优化） -->
		<BaseFooter client:visible />
		
		<!-- Vercel Speed Insights - 仅在 Vercel 环境下加载 -->
		{isVercel && <SpeedInsights />}
	</body>
</html>
